/*! saml-ecp-client-js 2016-05-02 */
define("saml-ecp-client-js",[],function(){function a(a,b){var c=b.trim().toLowerCase();for(var d in a)if(a.hasOwnProperty(d)&&d.trim().toLowerCase()==c)return a[d];return null}function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a){var b=new XMLSerializer;return b.serializeToString("undefined"!=typeof a.documentElement?a.documentElement:a)}function d(a,b){var c=a+":"+b;return"Basic "+q.base64.encode(c)}function e(a,b,c){var d=a.getElementsByTagNameNS(b,c);if(0===d.length)return!1;var e=d[0];e.parentNode.removeChild(e)}function f(a){for(var b={},c=a.childNodes,d=0;d<c.length;d++){var e=c[d],f=e.nodeName.split(":"),g=1==f.length?f[0]:f[1];switch(g){case"StatusMessage":b.statusMessage=e.textContent;break;case"StatusDetail":break;case"StatusCode":if(b.statusCode=[],b.statusCode.push(e.getAttribute("Value")),e.childNodes.length>0)for(var h=0;h<e.childNodes.length;h++)e.childNodes[h]instanceof Text||b.statusCode.push(e.childNodes[h].getAttribute("Value"))}}return b}function g(a){var b={},c=a.childNodes;if(void 0===c)return b;for(var d=0;d<c.length;d++){var e=c[d],f=e.nodeName.split(":"),g=1==f.length?f[0]:f[1];b[g.toLowerCase()]=e.textContent}return b}function h(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return b>-1||c>-1}function i(a,b,c){if(h()){var d="";for(var e in c)d+="xmlns:"+e+"="+c[e]+" ";return a.setProperty("SelectionNamespaces",d),a.selectNodes(b)}for(var f,g=function(a){return c[a]},i=a.evaluate(b,a,g,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),j=[];f=i.iterateNext();)j.push(f);return j}function j(a,b){if(null!==a)for(var c in a)if(a.hasOwnProperty(c)&&"paos"!=c.toLowerCase())for(var d=a[c],e=0;e<d.length;e++)b.setRequestHeader(c,d[e])}function k(a,b){var c=b.responseText;return q.Client.isResponseAnAuthRequest(q.Client.parseResponseHeadersString(b.getAllResponseHeaders()),c)?void l.call(this,a,b.responseText):void a.onSuccess(c,b.statusText,b)}function l(a,b){var f=this.parser.parseFromString(b,"text/xml"),h=i(f,"//SOAP_ENV:Envelope/SOAP_ENV:Header/PAOS:Request",t);a.responseConsumerURL=h[0].getAttribute("responseConsumerURL");var j=this,k=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;k.open("POST",a.idpEndpointUrl,!0),k.setRequestHeader(s.CONTENT_TYPE.KEY,s.CONTENT_TYPE.XML),k.withCredentials=!0,null!==a.password&&k.setRequestHeader("Authorization",d(a.username,a.password)),k.onreadystatechange=function(){if(4==k.readyState){if(0===k.status&&console.warn("HTTP request to "+a.idpEndpointUrl+" failed with status 0 (possible cross-domain request failure?)"),clearTimeout(a.deadlineTimer),200!=k.status){if(null!==a.onEcpError){var b=j.parser.parseFromString(k.responseText,"text/xml"),c=i(b,"//SOAP_ENV:Envelope/SOAP_ENV:Body/SOAP_ENV:Fault",t);if(c.length>0)return void a.onEcpError({errorCode:q.ECP_ERROR.IDP_SOAP_FAULT,status:g(c[0])})}return void(null!==a.onError&&a.onError(k,"Received invalid HTTP response while attempting to communicate with IdP URL '"+a.idpEndpointUrl+"'"))}m.call(j,a,k.responseText)}},0!==a.samlTimeout&&(a.deadlineTimer=setTimeout(function(){k.abort(),a.onSamlTimeout(k)},a.samlTimeout)),e(f,t.SOAP_ENV,"Header"),k.send(r+c(f))}function m(a,b){var c=this.parser.parseFromString(b,"text/xml"),d=this,e=i(c,"//SOAP_ENV:Envelope/SOAP_ENV:Body/SAML2P:Response/SAML2P:Status",t),g=f(e[0]);if(g.statusCode[0]==q.SAML2_STATUS.SUCCESS)return void o.call(this,a,b);if(null!==a.onEcpError&&a.onEcpError({errorCode:q.ECP_ERROR.IDP_RESPONSE_ERROR,status:g}),null===a.onEcpAuth){if(null===a.onEcpError)return;return void a.onEcpError({errorCode:q.ECP_ERROR.CLIENT_CONFIG_ERROR,errorMsg:"Authentication is required and a onEcpAuth callback was not provided."})}a.onEcpAuth(new n(a,function(){d.ajax(a.method,a.url,a.data,a)}))}function n(a,b){this.callCtx=a,this.retryFunction=b}function o(a,b){var c=this.parser.parseFromString(b,"text/xml"),d=i(c,"//SOAP_ENV:Envelope/SOAP_ENV:Body/SAML2P:Response/SAML2P:Status",t),e=f(d[0]);if(e.statusCode[0]!=q.SAML2_STATUS.SUCCESS)return void(null!==a.onEcpError&&a.onEcpError({errorCode:q.ECP_ERROR.IDP_RESPONSE_ERROR,status:e}));var g=i(c,"//SOAP_ENV:Envelope/SOAP_ENV:Header/ECP:Response",t),h=g[0].getAttribute("AssertionConsumerServiceURL"),j=new XMLSerializer,k=(j.serializeToString(c),this),l=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;l.open("POST",h,!0),l.setRequestHeader(s.CONTENT_TYPE.KEY,s.CONTENT_TYPE.PAOS),l.withCredentials=!0,l.onreadystatechange=function(){return 4==l.readyState?(0===l.status&&console.warn("HTTP request to "+h+" failed with status 0 (possible cross-domain request failure?)"),clearTimeout(a.deadlineTimer),200!=l.status&&302!=l.status?void(null!==a.onError&&a.onError(l,"Error occurred while posting back IdP response")):void(a.retrieveResource?p.call(k,a,l.responseText):null!==a.onSuccess&&a.onSuccess(null,null,l))):void 0},0!==a.samlTimeout&&(a.deadlineTimer=setTimeout(function(){l.abort(),a.onSamlTimeout(l)},a.samlTimeout)),l.send(b)}function p(a){var b=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;b.open(a.method,a.url,!0),b.setRequestHeader(s.ACCEPT.KEY,s.ACCEPT.PAOS),b.setRequestHeader(s.PAOS.KEY,s.PAOS.SAML2_ECP),b.withCredentials=!0,b.onreadystatechange=function(){4===b.readyState&&(clearTimeout(a.deadlineTimer),0===b.status?(console.warn("HTTP request to "+a.url+" failed with status 0 (possible cross-domain request failure?)"),null!==a.onError&&a.onError(b,"Received invalid HTTP response while attempting to communicate with SP URL '"+a.url+"'")):null!==a.onSuccess&&a.onSuccess(b.responseText,b.statusText,b))},0!==a.resourceTimeout&&(a.deadlineTimer=setTimeout(function(){b.abort(),a.onResourceTimeout(b)},a.resourceTimeout)),j(a.requestHeaders,b),b.send(a.data)}var q=q||{},q=q||{};q.base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=q.base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+q.base64._keyStr.charAt(e)+q.base64._keyStr.charAt(f)+q.base64._keyStr.charAt(g)+q.base64._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=q.base64._keyStr.indexOf(a.charAt(j++)),f=q.base64._keyStr.indexOf(a.charAt(j++)),g=q.base64._keyStr.indexOf(a.charAt(j++)),h=q.base64._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=q.base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){var b,c,d,e="",f=0;for(d=b=c=0;f<a.length;)d=a.charCodeAt(f),128>d?(e+=String.fromCharCode(d),f++):d>191&&224>d?(c=a.charCodeAt(f+1),e+=String.fromCharCode((31&d)<<6|63&c),f+=2):(c=a.charCodeAt(f+1),c3=a.charCodeAt(f+2),e+=String.fromCharCode((15&d)<<12|(63&c)<<6|63&c3),f+=3);return e}};var q=q||{};q.ECP_ERROR={IDP_RESPONSE_ERROR:-1,IDP_SOAP_FAULT:-2,CONSUMER_URL_MISMATCH:-3,CLIENT_CONFIG_ERROR:-4},q.SAML2_STATUS={SUCCESS:"urn:oasis:names:tc:SAML:2.0:status:Success",REQUESTER:"urn:oasis:names:tc:SAML:2.0:status:Requester",RESPONDER:"urn:oasis:names:tc:SAML:2.0:status:Responder",VERSION_MISMATCH:"urn:oasis:names:tc:SAML:2.0:status:VersionMismatch",AUTHN_FAILED:"urn:oasis:names:tc:SAML:2.0:status:AuthnFailed",INVALID_ATTR_NAME_OR_VALUE:"urn:oasis:names:tc:SAML:2.0:status:InvalidAttrNameOrValue",INVALID_NAME_ID_POLICY:"urn:oasis:names:tc:SAML:2.0:status:InvalidNameIDPolicy",NO_AUTHN_CONTEXT:"urn:oasis:names:tc:SAML:2.0:status:NoAuthnContext",NO_AVAILABLE_IDP:"urn:oasis:names:tc:SAML:2.0:status:NoAvailableIDP",NO_PASSIVE:"urn:oasis:names:tc:SAML:2.0:status:NoPassive",NO_SUPPORTED_IDP:"urn:oasis:names:tc:SAML:2.0:status:NoSupportedIDP",PARTIAL_LOGOUT:"urn:oasis:names:tc:SAML:2.0:status:PartialLogout",PROXY_COUNT_EXCEEDED:"urn:oasis:names:tc:SAML:2.0:status:ProxyCountExceeded",REQUEST_DENIED:"urn:oasis:names:tc:SAML:2.0:status:RequestDenied",REQUEST_UNSUPPORTED:"urn:oasis:names:tc:SAML:2.0:status:RequestUnsupported",REQUEST_VERSION_DEPRECATED:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionDeprecated",REQUEST_VERSION_TOO_HIGH:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionTooHigh",REQUEST_VERSION_TOO_LOW:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionTooLow",RESOURCE_NOT_RECOGNIZED:"urn:oasis:names:tc:SAML:2.0:status:ResourceNotRecognized",TOO_MANY_RESPONSES:"urn:oasis:names:tc:SAML:2.0:status:TooManyResponses",UNKNOWN_ATTR_PROFILE:"urn:oasis:names:tc:SAML:2.0:status:UnknownAttrProfile",UNKNOWN_PRINCIPAL:"urn:oasis:names:tc:SAML:2.0:status:UnknownPrincipal",UNSUPPORTED_BINDING:"urn:oasis:names:tc:SAML:2.0:status:UnsupportedBinding"},q.SOAP_FAULT_CODE={SOAP_VERSION_MISMATCH:"soap11:VersionMismatch",SOAP_MUST_UNDERSTAND:"soap11:MustUnderstand",SOAP_CLIENT:"soap11:Client",SOAP_SERVER:"soap11:Server"};var q=q||{},r='<?xml version="1.0" encoding="UTF-8"?>',s={ACCEPT:{KEY:"Accept",PAOS:"text/html; application/vnd.paos+xml"},PAOS:{KEY:"PAOS",SAML2_ECP:'ver="urn:liberty:paos:2003-08";"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"'},CONTENT_TYPE:{KEY:"Content-Type",XML:"text/xml;charset=UTF-8",PAOS:"application/vnd.paos+xml"}},t={SOAP_ENV:"http://schemas.xmlsoap.org/soap/envelope/",ECP:"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp",PAOS:"urn:liberty:paos:2003-08",SAML2P:"urn:oasis:names:tc:SAML:2.0:protocol"};return q.Client=function(a){this.config={samlTimeout:0,resourceTimeout:0,onError:null,onEcpError:null,onEcpAuth:null,onSuccess:null,onSamlTimeout:null,onResourceTimeout:null,xhrFactory:null,username:null,password:null,retrieveResource:!0},b(this.config,a),this.parser=new DOMParser},q.Client.prototype={get:function(a,b,c){this.ajax("GET",a,void 0,b,c)},post:function(a,b,c,d){this.ajax("POST",a,b,c,d)},put:function(a,b,c,d){this.ajax("PUT",a,b,c,d)},patch:function(a,b,c,d){this.ajax("PATCH",a,b,c,d)},"delete":function(a,b,c,d){this.ajax("DELETE",a,b,c,d)},ajax:function(a,c,d,e,f){var g={};b(g,this.config),b(g,e),g.url=c,g.method=a,g.data=d,void 0===g.requestHeaders&&(g.requestHeaders=void 0===f?{}:f);var h=this;if(null===g.username)return void g.onEcpAuth(new n(g,function(){h.ajax(g.method,g.url,g.data,g)}));var i=null!==g.xhrFactory?g.xhrFactory():new XMLHttpRequest;i.open(a,c),i.setRequestHeader(s.ACCEPT.KEY,s.ACCEPT.PAOS),i.setRequestHeader(s.PAOS.KEY,s.PAOS.SAML2_ECP),i.withCredentials=!0,i.onreadystatechange=function(){4==i.readyState&&(0===i.status&&console.warn("HTTP request to "+c+" failed with status 0 (possible cross-domain request failure?)"),clearTimeout(g.deadlineTimer),k.call(h,g,i))},0!==g.resourceTimeout&&(g.deadlineTimer=setTimeout(function(){i.abort(),g.onResourceTimeout(i)},g.resourceTimeout)),j(g.requestHeaders,i),i.send(g.data)},auth:function(a,c,d,e,f,g){var h=this,i={};return b(i,this.config),b(i,f),i.url=d,i.method=a,i.data=e,void 0===i.requestHeaders&&(i.requestHeaders=void 0===g?{}:g),null===i.username?void i.onEcpAuth(new n(i,function(){h.ajax(a,i.url,i.data,i)})):void l.call(this,i,c)}},q.Client.parseResponseHeadersString=function(a){for(var b=a.split("\r\n"),c={},d=0;d<b.length;d++){var e=/^(.+?):(.*)/.exec(b[d]);null!==e&&(c[e[1].trim()]=e[2].trim())}return c},q.Client.isResponseAnAuthRequest=function(b,c){var d=a(b,"content-type");if(null===d)return!1;var e=null,f=null;if(!d.split(";").some(function(a){return a.trim().toLowerCase()==s.CONTENT_TYPE.PAOS}))return!1;var g=new DOMParser;return e=g.parseFromString(c,"text/xml"),f=i(e,"//SOAP_ENV:Envelope/SOAP_ENV:Header/PAOS:Request",t),0!==f.length},n.prototype={setUsername:function(a){this.callCtx.username=a},getUsername:function(){return this.callCtx.username},setPassword:function(a){this.callCtx.password=a},retryAuth:function(){this.retryFunction()}},q});