/*! saml-ecp-client-js 2016-01-03 */
define("saml-ecp-client-js",[],function(){function a(a,b){var c=b.trim().toLowerCase();for(var d in a)if(a.hasOwnProperty(d)&&d.trim().toLowerCase()==c)return a[d];return null}function b(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function c(a){var b=new XMLSerializer;return b.serializeToString("undefined"!=typeof a.documentElement?a.documentElement:a)}function d(a,b){var c=a+":"+b;return"Basic "+o.base64.encode(c)}function e(a,b,c){var d=a.getElementsByTagNameNS(b,c);if(0===d.length)return!1;var e=d[0];e.parentNode.removeChild(e)}function f(a){for(var b={},c=a.childNodes,d=0;d<c.length;d++){var e=c[d],f=e.nodeName.split(":"),g=1==f.length?f[0]:f[1];switch(g){case"StatusMessage":b.statusMessage=e.textContent;break;case"StatusDetail":break;case"StatusCode":if(b.statusCode=[],b.statusCode.push(e.getAttribute("Value")),e.childNodes.length>0)for(var h=0;h<e.childNodes.length;h++)e.childNodes[h]instanceof Text||b.statusCode.push(e.childNodes[h].getAttribute("Value"))}}return b}function g(){var a=window.navigator.userAgent,b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return b>-1||c>-1}function h(a,b,c){if(g()){var d="";for(var e in c)d+="xmlns:"+e+"="+c[e]+" ";return a.setProperty("SelectionNamespaces",d),a.selectNodes(b)}for(var f,h=function(a){return c[a]},i=a.evaluate(b,a,h,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),j=[];f=i.iterateNext();)j.push(f);return j}function i(a,b){var c=b.responseText;return o.Client.isResponseAnAuthRequest(o.Client.parseResponseHeadersString(b.getAllResponseHeaders()),c)?void j.call(this,a,b.responseText):void a.onSuccess(c,b.statusText,b)}function j(a,b){var f=this.parser.parseFromString(b,"text/xml"),g=h(f,"//SOAP_ENV:Envelope/SOAP_ENV:Header/PAOS:Request",r);a.responseConsumerURL=g[0].getAttribute("responseConsumerURL");var i=this,j=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;j.open("POST",a.idpEndpointUrl,!0),j.setRequestHeader(q.CONTENT_TYPE.KEY,q.CONTENT_TYPE.XML),j.withCredentials=!0,null!==a.password&&j.setRequestHeader("Authorization",d(a.username,a.password)),j.onreadystatechange=function(){return 4==j.readyState?(clearTimeout(a.deadlineTimer),200!=j.status?void(null!==a.onError&&a.onError(j,"Received invalid HTTP response while attempting to communicate with IdP URL '"+a.idpEndpointUrl+"'")):void k.call(i,a,j.responseText)):void 0},0!==a.samlTimeout&&(a.deadlineTimer=setTimeout(function(){j.abort(),a.onSamlTimeout(j)},a.samlTimeout)),e(f,r.SOAP_ENV,"Header"),j.send(p+c(f))}function k(a,b){var c=this.parser.parseFromString(b,"text/xml"),d=this,e=h(c,"//SOAP_ENV:Envelope/SOAP_ENV:Body/SAML2P:Response/SAML2P:Status",r),g=f(e[0]);if(g.statusCode[0]==o.SAML2_STATUS.SUCCESS)return void m.call(this,a,b);if(null!==a.onEcpError&&a.onEcpError({errorCode:o.ECP_ERROR.IDP_RESPONSE_ERROR,idpStatus:g}),null===a.onEcpAuth){if(null===a.onEcpError)return;return void a.onEcpError({errorCode:o.ECP_ERROR.CLIENT_CONFIG_ERROR,errorMsg:"Authentication is required and a onEcpAuth callback was not provided."})}a.onEcpAuth(new l(a,function(){d.ajax(a.method,a.url,a.data,a)}))}function l(a,b){this.callCtx=a,this.retryFunction=b}function m(a,b){var c=this.parser.parseFromString(b,"text/xml"),d=h(c,"//SOAP_ENV:Envelope/SOAP_ENV:Body/SAML2P:Response/SAML2P:Status",r),e=f(d[0]);if(e.statusCode[0]!=o.SAML2_STATUS.SUCCESS)return void(null!==a.onEcpError&&a.onEcpError({errorCode:o.ECP_ERROR.IDP_RESPONSE_ERROR,idpStatus:e}));var g=h(c,"//SOAP_ENV:Envelope/SOAP_ENV:Header/ECP:Response",r),i=g[0].getAttribute("AssertionConsumerServiceURL"),j=new XMLSerializer,k=(j.serializeToString(c),this),l=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;l.open("POST",i,!0),l.setRequestHeader(q.CONTENT_TYPE.KEY,q.CONTENT_TYPE.PAOS),l.withCredentials=!0,l.onreadystatechange=function(){return 4==l.readyState?(clearTimeout(a.deadlineTimer),200!=l.status&&302!=l.status?void(null!==a.onError&&a.onError(l,"Error occurred while posting back IdP response")):void n.call(k,a,l.responseText)):void 0},0!==a.samlTimeout&&(a.deadlineTimer=setTimeout(function(){l.abort(),a.onSamlTimeout(l)},a.samlTimeout)),l.send(b)}function n(a){var b=null!==a.xhrFactory?a.xhrFactory():new XMLHttpRequest;b.open(a.method,a.url,!0),b.setRequestHeader(q.ACCEPT.KEY,q.ACCEPT.PAOS),b.setRequestHeader(q.PAOS.KEY,q.PAOS.SAML2_ECP),b.withCredentials=!0,b.onreadystatechange=function(){4==b.readyState&&(clearTimeout(a.deadlineTimer),null!==a.onSuccess&&a.onSuccess(b.responseText,b.statusText,b))},0!==a.resourceTimeout&&(a.deadlineTimer=setTimeout(function(){b.abort(),a.onResourceTimeout(b)},a.resourceTimeout)),b.send(a.data)}var o=o||{},o=o||{};o.base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=o.base64._utf8_encode(a);j<a.length;)b=a.charCodeAt(j++),c=a.charCodeAt(j++),d=a.charCodeAt(j++),e=b>>2,f=(3&b)<<4|c>>4,g=(15&c)<<2|d>>6,h=63&d,isNaN(c)?g=h=64:isNaN(d)&&(h=64),i=i+o.base64._keyStr.charAt(e)+o.base64._keyStr.charAt(f)+o.base64._keyStr.charAt(g)+o.base64._keyStr.charAt(h);return i},decode:function(a){var b,c,d,e,f,g,h,i="",j=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");j<a.length;)e=o.base64._keyStr.indexOf(a.charAt(j++)),f=o.base64._keyStr.indexOf(a.charAt(j++)),g=o.base64._keyStr.indexOf(a.charAt(j++)),h=o.base64._keyStr.indexOf(a.charAt(j++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,i+=String.fromCharCode(b),64!=g&&(i+=String.fromCharCode(c)),64!=h&&(i+=String.fromCharCode(d));return i=o.base64._utf8_decode(i)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},_utf8_decode:function(a){var b,c,d,e="",f=0;for(d=b=c=0;f<a.length;)d=a.charCodeAt(f),128>d?(e+=String.fromCharCode(d),f++):d>191&&224>d?(c=a.charCodeAt(f+1),e+=String.fromCharCode((31&d)<<6|63&c),f+=2):(c=a.charCodeAt(f+1),c3=a.charCodeAt(f+2),e+=String.fromCharCode((15&d)<<12|(63&c)<<6|63&c3),f+=3);return e}};var o=o||{};o.ECP_ERROR={IDP_RESPONSE_ERROR:-1,CONSUMER_URL_MISMATCH:-2,CLIENT_CONFIG_ERROR:-3},o.SAML2_STATUS={SUCCESS:"urn:oasis:names:tc:SAML:2.0:status:Success",REQUESTER:"urn:oasis:names:tc:SAML:2.0:status:Requester",RESPONDER:"urn:oasis:names:tc:SAML:2.0:status:Responder",VERSION_MISMATCH:"urn:oasis:names:tc:SAML:2.0:status:VersionMismatch",AUTHN_FAILED:"urn:oasis:names:tc:SAML:2.0:status:AuthnFailed",INVALID_ATTR_NAME_OR_VALUE:"urn:oasis:names:tc:SAML:2.0:status:InvalidAttrNameOrValue",INVALID_NAME_ID_POLICY:"urn:oasis:names:tc:SAML:2.0:status:InvalidNameIDPolicy",NO_AUTHN_CONTEXT:"urn:oasis:names:tc:SAML:2.0:status:NoAuthnContext",NO_AVAILABLE_IDP:"urn:oasis:names:tc:SAML:2.0:status:NoAvailableIDP",NO_PASSIVE:"urn:oasis:names:tc:SAML:2.0:status:NoPassive",NO_SUPPORTED_IDP:"urn:oasis:names:tc:SAML:2.0:status:NoSupportedIDP",PARTIAL_LOGOUT:"urn:oasis:names:tc:SAML:2.0:status:PartialLogout",PROXY_COUNT_EXCEEDED:"urn:oasis:names:tc:SAML:2.0:status:ProxyCountExceeded",REQUEST_DENIED:"urn:oasis:names:tc:SAML:2.0:status:RequestDenied",REQUEST_UNSUPPORTED:"urn:oasis:names:tc:SAML:2.0:status:RequestUnsupported",REQUEST_VERSION_DEPRECATED:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionDeprecated",REQUEST_VERSION_TOO_HIGH:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionTooHigh",REQUEST_VERSION_TOO_LOW:"urn:oasis:names:tc:SAML:2.0:status:RequestVersionTooLow",RESOURCE_NOT_RECOGNIZED:"urn:oasis:names:tc:SAML:2.0:status:ResourceNotRecognized",TOO_MANY_RESPONSES:"urn:oasis:names:tc:SAML:2.0:status:TooManyResponses",UNKNOWN_ATTR_PROFILE:"urn:oasis:names:tc:SAML:2.0:status:UnknownAttrProfile",UNKNOWN_PRINCIPAL:"urn:oasis:names:tc:SAML:2.0:status:UnknownPrincipal",UNSUPPORTED_BINDING:"urn:oasis:names:tc:SAML:2.0:status:UnsupportedBinding"};var o=o||{},p='<?xml version="1.0" encoding="UTF-8"?>',q={ACCEPT:{KEY:"Accept",PAOS:"text/html; application/vnd.paos+xml"},PAOS:{KEY:"PAOS",SAML2_ECP:'ver="urn:liberty:paos:2003-08";"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp"'},CONTENT_TYPE:{KEY:"Content-Type",XML:"text/xml;charset=UTF-8",PAOS:"application/vnd.paos+xml"}},r={SOAP_ENV:"http://schemas.xmlsoap.org/soap/envelope/",ECP:"urn:oasis:names:tc:SAML:2.0:profiles:SSO:ecp",PAOS:"urn:liberty:paos:2003-08",SAML2P:"urn:oasis:names:tc:SAML:2.0:protocol"};return o.Client=function(a){this.config={samlTimeout:0,resourceTimeout:0,onError:null,onEcpError:null,onEcpAuth:null,onSuccess:null,onSamlTimeout:null,onResourceTimeout:null,xhrFactory:null,username:null,password:null},b(this.config,a),this.parser=new DOMParser},o.Client.prototype={get:function(a,b){this.ajax("GET",a,void 0,b)},post:function(a,b,c){this.ajax("POST",a,b,c)},put:function(a,b,c){this.ajax("PUT",a,b,c)},patch:function(a,b,c){this.ajax("PATCH",a,b,c)},"delete":function(a,b,c){this.ajax("DELETE",a,b,c)},ajax:function(a,c,d,e){var f={};b(f,this.config),b(f,e),f.url=c,f.method=a,f.data=d;var g=this;if(null===f.username)return void f.onEcpAuth(new l(f,function(){g.ajax(f.method,f.url,f.data,f)}));var h=null!==f.xhrFactory?f.xhrFactory():new XMLHttpRequest;h.open(a,c),h.setRequestHeader(q.ACCEPT.KEY,q.ACCEPT.PAOS),h.setRequestHeader(q.PAOS.KEY,q.PAOS.SAML2_ECP),h.withCredentials=!0,h.onreadystatechange=function(){4==h.readyState&&(clearTimeout(f.deadlineTimer),i.call(g,f,h))},0!==f.resourceTimeout&&(f.deadlineTimer=setTimeout(function(){h.abort(),f.onResourceTimeout(h)},f.resourceTimeout)),h.send(f.data)},auth:function(a,c,d,e,f){var g=this,h={};return b(h,this.config),b(h,f),h.url=d,h.method=a,h.data=e,null===h.username?void h.onEcpAuth(new l(h,function(){g.ajax(a,h.url,h.data,h)})):void j.call(this,h,c)}},o.Client.parseResponseHeadersString=function(a){for(var b=a.split("\r\n"),c={},d=0;d<b.length;d++){var e=/^(.+?):(.*)/.exec(b[d]);null!==e&&(c[e[1].trim()]=e[2].trim())}return c},o.Client.isResponseAnAuthRequest=function(b,c){var d=a(b,"content-type");if(null===d)return!1;var e=null,f=null;if(!d.split(";").some(function(a){return a.trim().toLowerCase()==q.CONTENT_TYPE.PAOS}))return!1;var g=new DOMParser;return e=g.parseFromString(c,"text/xml"),f=h(e,"//SOAP_ENV:Envelope/SOAP_ENV:Header/PAOS:Request",r),0!==f.length},l.prototype={setUsername:function(a){this.callCtx.username=a},getUsername:function(){return this.callCtx.username},setPassword:function(a){this.callCtx.password=a},retryAuth:function(){this.retryFunction()}},o});